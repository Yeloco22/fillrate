<!DOCTYPE html>
<html>
    <meta charset="utf-8">
<head>

	<title>FR Map</title>
    <meta charset="utf-8">
	<link rel="shortcut icon" href="images/favicon-02.png">
   

    <!-- JQUERY -->
	
    <script src="js/jquery/jquery.min.js"></script>
    <script src="js/d3/3.5.5/d3.min.js"></script>

    <!-- MAPAS -->
    <script src="Build/Cesium/Cesium.js"></script>

    <link rel="stylesheet" href="styles/main.css">

    
    <!-- FUENTES ICONOS -->
   
    <link href='https://fonts.googleapis.com/css?family=Cabin' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Coda:400,800' rel='stylesheet' type='text/css'>

    <!-- CONTROLS -->
    <script src="js/autocomplete.js"></script>

    <!-- EXPERTOS EN KPI -->
    
    <script src="js/experts/calculateKpiExpert_FR.js"></script>
    <script src="js/experts/calculateKpiExpert_OOS.js"></script>   
    <script src="js/experts/calculateKpiExpert_OOSFiliales.js"></script> 
    <script src="js/experts/calculateKpiExpert_Mas.js"></script>
    <script src="js/experts/calculateKpiExpert_Ventas.js"></script>
    <script src="js/experts/calculateKpiExpert_Pendientes.js"></script>
    <script src="js/experts/calculateKpiExpert_Abasto.js"></script>
    <script src="js/experts/calculateKpiExpert_Produccion.js"></script>
    <script src="js/experts/drawKpiExpert_ABAS.js"></script>
    <script src="js/experts/reportExpert.js"></script>

    <script src="js/experts/drawKpiExpert_FR.js"></script>
    <script src="js/experts/drawKpiExpert_OOS.js"></script>
    <script src="js/experts/drawKpiExpert_OOS_Filiales.js"></script>
    <script src="js/experts/drawKpiExpert_PROD.js"></script>
    <script src="js/experts/drawKpiExpert_VENTAS.js"></script>
    <script src="js/experts/drawKpiExpert_MAS.js"></script>
    <script src="js/experts/drawKpiExpert_PEN.js"></script>

    <!-- CUSTOM -->
    <script src="js/loader.js"></script>
    <script src="js/config.js"></script>
    <script src="js/utilerias.js"></script>
    <script src="js/map.js"></script>    
    <script src="js/store.js"></script>
    <script src="js/controls.js"></script>
    <script src="js/dataManager.js"></script>
    <script src="js/radar.js"></script>
    <script src="js/elementosContexo.js"></script>

    <script src="js/tooltipHelpers.js"></script>
    <script src="js/workersProcessor.js"></script>

    <script src="js/regionesGeoJson.js"></script>

    <link rel='stylesheet' href='./styles/style.css' />
    <script src="https://unpkg.com/gijgo@1.9.14/js/gijgo.min.js" type="text/javascript"></script>
    <link href="https://unpkg.com/gijgo@1.9.14/css/gijgo.min.css" rel="stylesheet" type="text/css" />


     <!-- VIX_TT  -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
   <style>
       th.sorted {
         background-color: #ffeeba; /* Set the background color for the sorted column */
       }
     
       th:not(.sorted) {
         background-color: transparent; /* Clear the background color for other columns */
       }


       .header-cell {
             color:#8EBBFF;
             border: 0px solid white;
             padding: 8px;
             font-size: 12px;
             text-align: left;
        }

        .body-cell {
             color:#FFFFFF;
             border: 0px solid white;
             padding: 8px;
             font-size: 12px;
        }

        .totals-row {
             color:#ea09e2;
             border: 0px solid white;
             padding: 8px;
             font-size: 12px;
        }


        .bar-container {
             display: flex;
             align-items: center;
        }


        .key-selector{
             display: flex;
             align-items: center;
        }
        .key-selector:hover{
            color:#000000;
            background-color: lightgray;
            cursor: pointer; 
        }



         

        .bar-value {
             margin-left: 1px; /* Add some spacing between the bar and value */
             margin-right: 8px;
         }

         .tooltip-table {
            border-collapse: collapse;
            border: 0;
            /* Other styling properties */
        }

        .tooltip-table th, .tooltip-table td {
            padding: 0;
            /* Other cell styling properties */
        }

        .tooltipIcon {
            position: relative;
            display: inline-block;
        }

        .tooltip-text {
            visibility: hidden;
            width: 150px;
            background-color: #1e1e29;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: -100%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s;
            font-size: 14px;
            box-shadow: 5px 5px 10px #000000;
            border-style: solid;
            border-color: #1f3b45;
            border-width: 1px;
        }

        .tooltipIcon:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

  
   </style>

</head>

<style>


.hr{

border: 0;
height: 1px;
background: #333;
background-image: linear-gradient(to right, #cccccc, #000000);
width:100%;
z-index:900;

}

.listado:hover {

color: yellow;

}


</style>

<body onresize=" Stage.ReorderLayout();  " >
    <svg>
        <defs>
        
              <filter id='dropshadow' height='140%' width='140%'>
                  <feGaussianBlur in='SourceAlpha' stdDeviation='4'/> <!-- stdDeviation is how much to blur -->
                  <feOffset dx='3' dy='3' result='offsetblur'/> <!-- how much to offset -->
                  <feMerge><feMergeNode/> <!-- this contains the offset blurred image -->
                  <feMergeNode in='SourceGraphic'/> <!-- this contains the element that the filter is applied to --></feMerge>
              </filter>
              <filter id='dropshadowRadar' height='140%' width='140%'>
                <feGaussianBlur in='SourceAlpha' stdDeviation='10'/> <!-- stdDeviation is how much to blur -->
                <feOffset dx='0' dy='6' result='offsetblur'/> <!-- how much to offset -->
                <feMerge><feMergeNode/> <!-- this contains the offset blurred image -->
                <feMergeNode in='SourceGraphic'/> <!-- this contains the element that the filter is applied to --></feMerge>
            </filter>

              <filter id="glow" x="-130%" y="-130%" height="500%" width="500%">
                <feGaussianBlur stdDeviation="5" result="coloredBlur"/>
                <feMerge>
                <feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/>
                </feMerge>
              </filter>    
              
              <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" style="stop-color:rgb(0,0,0);stop-opacity:1" />
                <stop offset="80%" style="stop-color:rgb(0,0,0);stop-opacity:0" />
               </linearGradient>
             
              <linearGradient id="grad2" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" style="stop-color:rgb(0,0,0);stop-opacity:0" />
                <stop offset="80%" style="stop-color:rgb(0,0,0);stop-opacity:1" />
               </linearGradient>

               <filter id='dropshadowText' height='140%' width='140%'>
                <feGaussianBlur in='SourceAlpha' stdDeviation='3'/> <!-- stdDeviation is how much to blur -->
                <feOffset dx='1' dy='1' result='offsetblur'/> <!-- how much to offset -->
                <feMerge><feMergeNode/> <!-- this contains the offset blurred image -->
                <feMergeNode in='SourceGraphic'/> <!-- this contains the element that the filter is applied to --></feMerge>
                </filter>
        </defs>
        </svg>

        <div style="position:fixed;z-index:-10;float:left;top:0px;pointer-events:none;height:100%;width:100%;background:linear-gradient(#000000, #000000);"></div>

        <div style="position:fixed;z-index:-10;float:left;top:0px;pointer-events:none;height:100%;width:100%;background:linear-gradient(#000000, #000000);"></div>

        <div id="cesiumContainer" style="position:fixed;top:0px;z-index:1;background-color: black"></div>
        
        <img id="logo" src="images/logo1.png" style="position:fixed;z-index:9999999;width:140px;float:left;left:10px;top:11px;pointer-events: none;visibility:visible;"></img>

      
        <img id="cargando" src="images/preloader_7.gif" style="width:100px;position:fixed;float:left;left:50%;top:10%;pointer-events: none;z-index:100;visibility:hidden;padding:30px;opacity:.7"></img>

        <div id="toolTip" style="position:fixed;top:300px;left:500px;line-height:24px;font-family:Cabin;box-shadow: rgba(0, 0, 0,.6) 5px 10px 19px;color:white;font-size:19px;font-weight:normal;z-index:999999;border-style:solid;border-color:#507D8C;border-width:1px;background-color:rgba(0,0,0,.8);padding:0px;pointer-events:auto;border-radius:6px;visibility:hidden"></div>
        <div id="toolTip2" style="position:fixed;top:300px;left:500px;line-height:24px;font-family:Cabin;box-shadow: 5px 5px 10px #000000;color:white;font-size:19px;font-weight:normal;z-index:999999;border-style:solid;border-color:#507D8C;border-width:1px;background-color:rgba(0,0,0,.8);padding:10px;pointer-events:auto;border-radius:6px;visibility:hidden"></div>
        <div id="toolTip3" style="position:fixed;top:300px;left:500px;line-height:24px;font-family:Cabin;box-shadow: 5px 5px 10px #000000;color:white;font-size:19px;font-weight:normal;z-index:999999;border-style:solid;border-color:#507D8C;border-width:1px;background-color:rgba(0,0,0,.8);padding:10px;pointer-events:auto;border-radius:6px;visibility:hidden"></div>
        <div id="toolTip4" style="position:fixed;top:300px;left:500px;line-height:24px;font-family:Cabin;box-shadow: 5px 5px 10px #000000;color:white;font-size:19px;font-weight:normal;z-index:999999;border-style:solid;border-color:#507D8C;border-width:1px;background-color:rgba(0,0,0,.9);padding:10px;pointer-events:auto;border-radius:6px;visibility:hidden"></div>
        <div id="toolTip5" style="position:fixed;top:300px;left:500px;line-height:24px;font-family:Cabin;box-shadow: 5px 5px 10px #000000;color:white;font-size:19px;font-weight:normal;z-index:999999;border-style:solid;border-color:#507D8C;border-width:1px;background-color:rgba(0,0,0,.9);padding:10px;pointer-events:auto;border-radius:6px;visibility:hidden"></div>
        <div id="toolTipLoader" style="position:fixed;top:300px;left:500px;line-height:24px;font-family:Cabin;box-shadow: rgba(0, 0, 0,.4) 5px 15px 16px ;color:white;font-size:19px;font-weight:normal;z-index:999999;border-style:solid;border-color:#507D8C;border-width:1px;background-color:rgba(0,0,0,.9);padding:10px;pointer-events:auto;border-radius:6px;visibility:hidden;"></div>

        <svg id="svgLines"  height="100%" width="100%" style="position:fixed;top:0;left:0px;pointer-events: none;z-index:8000"/>

        <ul class="fa-ul" style="position:absolute;right:2px;top:38px;color:rgb(255, 255, 255);z-index:99999;font-family:Cabin;right:0px;">
            <div class="tooltipIcon"><img id="cargando" src="images/hexagons_.png" onclick="radar.DecreaseRadars();" style="width:18px ;float:left;margin:8px"></img><div class="tooltip-text">Disminuir Columnas</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/hexagons.png" onclick="radar.IncreaseRadars();" style="width:18px ;float:left;margin:8px"></img><div class="tooltip-text">Aumentar Columnas</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/increase.png" onclick="radar.escalado=radar.escalado*(1.1);radar.DrawEntities(radar.lastRadarEntities);" style="width:18px ;float:left;margin:8px"></img><div class="tooltip-text">Aumentar tamaño Radar</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/decrease.png" onclick="radar.escalado=radar.escalado*(.9);radar.DrawEntities(radar.lastRadarEntities);" style="width:18px ;float:left;margin:8px"></img><div class="tooltip-text">Disminuir tamaño Radar</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/fontSize1.png" onclick="escalaTextos=escalaTextos*(1.1);if(kpiExpert_FR){kpiExpert_FR.DrawMainHeader(); kpiExpert_FR.DrawFilteredHeader();filterControls.showActiveFilters();}" style="width:13px ;float:left;margin:8px"></img><div class="tooltip-text">Tamaño texto</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/fontSize2.png" onclick="escalaTextos=escalaTextos*(.9);if(kpiExpert_FR){kpiExpert_FR.DrawMainHeader(); kpiExpert_FR.DrawFilteredHeader();filterControls.showActiveFilters();}" style="width:13px ;float:left;margin:8px"></img><div class="tooltip-text">Tamaño texto</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/chemical.png" onclick="$('#Controls').css('visibility','visible');" style="width:13px;float:left;margin:8px"></img><div class="tooltip-text">Filtros</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/calendar.png" onclick="location.reload()" style="width:13px ;float:left;margin:8px"></img><div class="tooltip-text">Cambiar Fechas</div></div>
            <div class="tooltipIcon"><img id="cargando" src="images/analyticsx.png" onclick='$("#toolTip4").css("visibility")=="visible"? reportExpert.EraseReport()  : reportExpert.DrawReport(entities)' style="width:13px;float:left;margin:8px"></img><div class="tooltip-text">Informe Final</div></div>
            
        </ul>

        <ul class="fa-ul" style="position:absolute;right:2px;top:-9px;color:rgb(255, 255, 255);z-index:99999;font-family:Cabin;right:0px;">
            
            <div class="tooltipIcon"><img id="iconFR" class="iconKPI" src="images/mode1_.png" onclick="dataManager.CambiaModoKPI('FR')" style="width:30px ;float:left;margin:8px" ></img><div class="tooltip-text">Cambiar a Fillrate</div></div>
            <div class="tooltipIcon"><img id="iconOOSF" class="iconKPI" src="images/mode_2.png" onclick="dataManager.CambiaModoKPI('OOS F')" style="width:30px ;float:left;margin:8px"></img><div class="tooltip-text">Cambiar a OOS Fliliales</div></div>
            <div class="tooltipIcon"><img id="iconVenta" class="iconKPI" src="images/mode_3.png" onclick="dataManager.CambiaModoKPI('Venta')" style="width:30px;float:left;margin:8px"></img><div class="tooltip-text">Cambiar a Vengas</div></div>

        </ul>

        <ul class="fa-ul" style="position:fixed;left:-12px;top:70px;color:rgb(255, 255, 255);z-index:99999;font-family:Cabin;">
            
            <div class="tooltipIcon"><img id="ordenVol" class="iconKPI" src="images/order1_.png" onclick="ordenRadares='Vol';radar.DrawEntities();" style="width:23px ;float:left;margin:8px" ></img><div class="tooltip-text">Ordenar por Volumen</div></div>
            <div class="tooltipIcon"><img id="ordenFR" class="iconKPI" src="images/order2.png" onclick="ordenRadares='FR';radar.DrawEntities();" style="width:23px ;float:left;margin:8px" ></img><div class="tooltip-text">Ordenar por FillRate</div></div>
            <div class="tooltipIcon"><img id="ordenOOS" class="iconKPI" src="images/order3.png" onclick="ordenRadares='OOS';radar.DrawEntities();" style="width:23px ;float:left;margin:8px"></img><div class="tooltip-text">Ordenar por OOS CED</div></div>
            <div class="tooltipIcon"><img id="ordenVen" class="iconKPI" src="images/order4.png" onclick="ordenRadares='Ven';radar.DrawEntities();" style="width:23px;float:left;margin:8px"></img><div class="tooltip-text">Ordenar por Ventas</div></div>

        </ul>

        <div id="titulo" class="sombra" align="left" style="position:fixed;top:13px;left:168px;font-family:Cabin;pointer-events:none;font-size:18px;color:#7DDFFF;opacity:1;font-weight:bold;z-index:9999"/> 
        
        </div>


        <ul class="fa-ul" style="position:absolute;right:143px;top:-15px;color:rgb(255, 255, 255);z-index:99999;font-family:Cabin">   
            
            <img id="back_btn" src="images/back_icon.png" onclick="filterControls.back()" style="width:43px;float:left;margin:8px;visibility:hidden"></img>

        </ul>

        <div class="item2 loginContainer login-page form " style="float:left;margin-top:100px;visibility:hidden;">

            <div class="dateContainer " style="padding-top: 0px;">
        
                <input id="datepicker" width="100%" placeholder="From"/>
                <input id="datepicker2" width="100%" placeholder="To"/>
                </select>
        
                <br><br>
                <button class="loginBtn" onclick="">Get Data</button>      
            </div>    
    
        </div>

        <ul id="Controls" class="fa-ul" style="width:150px;float:left;position:fixed;top:120px;font-family:Cabin;box-shadow: 5px 5px 20px #000000;right:10px;font-size:11px;z-index:9999999;opacity:1;line-height: 8px;margin:0px;text-transform:uppercase;border-style:solid;border-color:#254650;border-width:1px;color:#000000;background-color:rgba(0,0,0,.9);padding:20px;border-radius:9px;">
        </ul>
        

    </body> 

    
  

    <script>


        // Querys a ejecutar por el worker de manera serial :

        const queries = [
            {
                url: "https://uscldv3dwad01.azurewebsites.net/getSP/VIS_Calcular_KPI_Produccion_FillRate?fechaInicio=2023-05-01&fechaFin=2023-05-31&agrupador=Estado",
                id: 1
            },
            {
                url: "https://uscldv3dwad01.azurewebsites.net/getSP/VIS_Calcular_KPI_Abasto_FillRate?fechaInicio=2023-05-01&fechaFin=2023-05-31&agrupador=Estado",
                id: 2
            },
        ];
        


        // Funcion que procesara los datos a recibir (data)

        function processData(id, data) {
            console.log("Procesando query  :", id);
            switch (id) {
                case 1:
                  console.log('query 1');
                  break;
                case 2:
                case 3:
                  console.log('query 3');
                  
                  break;
                default:
                  console.log("id incorrecto");
              }
        }
        

       // llama al procesador sin bloquear el main thread

        processQueriesWithWorker(queries, processData);


    </script>
    
   



    <script>

        // Versión: 1.0.0 
        //Editor: Daniel Contreras Calderon
        // Comentarios de version: ""

        var windowWidth; 
        var windowHeight; 

        Stage.ReorderLayout();

        var escalaTextos=1;

        $(function() {

            $('#datepicker').datepicker({format: 'mm-dd-yyyy'});
            $('#datepicker2').datepicker({format: 'mm-dd-yyyy'});            

            $("#cargando").css("visibility","hidden");

            window.document.addEventListener("mousemove", function(event){

                mouse_x=event.pageX;
        
                mouse_y=event.pageY;
        
            });

            var fechaActual=new Date();
            var ayer=new Date(fechaActual.getTime()-((1000*60)*60)*24);

            $('#datepicker').val((ayer.getMonth()+1)+"-01-2023");
            $('#datepicker2').val((ayer.getMonth()+1)+"-"+(ayer.getDate())+"-2023");

            //setTimeout(()=>{$(".loginBtn").click()}, 1000);
            
            $(".loginBtn").click(function(){
               
                if( $('#datepicker').val() && $('#datepicker2').val() ){

                    dateInit=new Date($('#datepicker').val());
                    dateEnd=new Date($('#datepicker2').val());

                    dataLoader.LoadInitialData( store.localDataSources.concat(store.apiDataSources) ).then(function(){

                        DibujaRegiones();

                        DibujaEstados();

                        filterControls.creaCatalogoDeFrentesDesdeClientes();

                        filterControls.createDataFiltersControls(store.catlogsForFilters);
                        filterControls.createHardCodedControls();
                        radar.radarInitStage();

                        if(elementosContextoMapa)
                            elementosContextoMapa.DibujaUNs();                        

                    })

                    $('.loginContainer').css('visibility','hidden');

                }else{
                    alert('Seleccione fechas');
                }
        
            });


            new Promise(Stage.initStage).then(
                $('.loginContainer').css('visibility','visible')
            );

        });

        var opacidadCesium=100;

    document.onkeydown = function(event) {
        console.log(event.keyCode);
    
        switch (event.keyCode) {
         
            //MODIFICA TAMAÑO DE CILINDROS
            case 39:   
                escalado=escalado*(.7);
                Stage.DrawMapObjects(currentEntities,store.mainDataset);
            break;
            case 37:   
                escalado=escalado*(1.3);
                Stage.DrawMapObjects(currentEntities,store.mainDataset);
            break;
            //MODIFICA OPACIDAD DEL MAPA
            case 38:   
                opacidadCesium-=8;
                $("#cesiumContainer").css("opacity",opacidadCesium/100);
            break;
            case 40:   
                opacidadCesium+=8;
                $("#cesiumContainer").css("opacity",opacidadCesium/100);
            break;
          
           
            case 87:   

                
            break;
            case 83:   
                   

            break;

            case 49:   

                columnasRadar=1;
                radar.DrawEntities(entities);

            break;
            case 50: 

                columnasRadar=2;
                radar.DrawEntities(entities);                  

            break;
            case 51: 

                columnasRadar=3;
                radar.DrawEntities(entities);                  

            break;
            case 52: 

                columnasRadar=4;
                radar.DrawEntities(entities);                  

            break;
            case 53: 

                columnasRadar=5;
                radar.DrawEntities(entities);                  

            break;
            case 54: 

                columnasRadar=6;
                radar.DrawEntities(entities);                  

            break;
    
        }
       
    }
    
    document.onkeyup = function(event) {
    
        switch (event.keyCode) {    
            case 49:


            break;
            case 50:
    
            break;
            case 51:    
    
            break;
    
            case 27:

            document.getElementById('svgLines').focus();

            radar.CleanWindows();
            
            break;
    
        }
    }
          

    </script>